"use strict";(self["webpackChunkteditor"]=self["webpackChunkteditor"]||[]).push([[506],{9085:(e,t,o)=>{o.d(t,{o:()=>s});var n=o(2502);const s=(0,n.Q_)("main",{state:()=>({panel:!0,theme:"Neat",mode:"JavaScript"}),getters:{sidePanel:e=>e.panel,editorTheme:e=>e.theme,editorMode:e=>e.mode},actions:{toggleSidePanel(){this.panel=!this.panel},setEditorTheme(e){this.theme=e},setEditorMode(e){this.mode=e}}})},3506:(e,t,o)=>{o.r(t),o.d(t,{default:()=>G});var n=o(9835),s=o(6970),r=o(1957);const i={class:"q-pa-md",style:{width:"100%",padding:"0 !important"}},a={key:0,class:"greeting column"},c=(0,n._)("svg",{width:"200",height:"200",viewBox:"0 0 1200 1270",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,n._)("path",{d:"M300 0.794922L0 174L300 347.205V274H500V1096.25H500.003L600 1269.45L699.997 1096.25H700L700 1096.24L700 274H900V347.205L1200 174L900 0.794922V74H300V0.794922Z",fill:"#00CFB3"})],-1),l={class:"tabs row no-wrap"},d=["onClick"],h=["onUpdate:modelValue","onBlur"],u={key:0,class:"side-panel col-3 order-last"},m=(0,n._)("i",{class:"q-icon notranslate material-icons","aria-hidden":"true",role:"presentation"},"close",-1),g=[m],p={class:"row side-panel-row"},b=["value"],y={class:"peers-count"},f={class:"counter"};function v(e,t,o,m,v,w){const x=(0,n.up)("q-btn"),C=(0,n.up)("code-editor"),k=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(k,{class:"flex"},{default:(0,n.w5)((()=>[(0,n._)("div",i,[Object.keys(e.documents).length||e.$q.loading.isActive?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",a,[c,(0,n.Wm)(x,{color:"accent",icon:"note_add",label:e.$t("index.newFile"),onClick:t[0]||(t[0]=t=>e.newTab())},null,8,["label"])])),(0,n._)("div",l,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.documents,((t,o,i)=>((0,n.wg)(),(0,n.iD)("div",{class:"tab",style:(0,s.j5)({background:o==e.currentTab?e.activeTabStyles.background:""}),key:o,onClick:n=>e.tabClickHandler(n,o,i,t.name)},[(0,n.wy)((0,n._)("input",{style:(0,s.j5)({color:o==e.currentTab?e.activeTabStyles.color:""}),type:"text",autocomplete:"off","onUpdate:modelValue":e=>t.name=e,readonly:"true",ondblclick:"this.readOnly=''",onblur:"this.readOnly='true'",onBlur:t=>e.updateDocName(o)},null,44,h),[[r.nr,t.name]]),(0,n._)("div",{style:(0,s.j5)({color:o==e.currentTab?e.activeTabStyles.color:""}),class:"tab-close",ref_for:!0,ref:"close_"+o},null,4)],12,d)))),128)),Object.keys(e.documents).length?((0,n.wg)(),(0,n.iD)("div",{key:0,class:"tab-add",onClick:t[1]||(t[1]=t=>e.newTab())})):(0,n.kq)("",!0)]),(0,n._)("div",{class:"row",style:(0,s.j5)({"box-shadow":e.activeTabStyles.shadow})},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.documents,((t,o)=>(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:"tab-content col",key:"tab_"+o},[(0,n.Wm)(C,{ref_for:!0,ref:"editor_"+o,documentKey:o,value:e.automerge[o].value.toString()},null,8,["documentKey","value"])])),[[r.F8,o==e.currentTab]]))),128)),e.store.sidePanel&&Object.keys(e.documents).length?((0,n.wg)(),(0,n.iD)("div",u,[(0,n._)("div",{class:"close",onClick:t[2]||(t[2]=t=>e.store.toggleSidePanel())},g),(0,n._)("div",p,[(0,n._)("input",{type:"text",value:e.connectUrl+e.peerId,disabled:""},null,8,b),(0,n.Wm)(x,{flat:"",color:"color",icon:"content_copy",onClick:e.copyLink},null,8,["onClick"]),(0,n._)("div",y,[(0,n._)("div",{class:"led",style:(0,s.j5)({"background-color":0==Object.keys(e.connectedPeers).length?"var(--q-negative)":"var(--q-positive)","box-shadow":0==Object.keys(e.connectedPeers).length?"0 0 5px var(--q-negative)":"0 0 5px var(--q-positive)"})},null,4),(0,n._)("span",f,(0,s.zw)(Object.keys(e.connectedPeers).length)+" "+(0,s.zw)(e.$t("index.peer.counter")),1)])])])):(0,n.kq)("",!0)],4)])])),_:1})}o(702),o(8979),o(8170),o(5231),o(9359),o(6408),o(8964);var w=o(499),x=o(1446),C=o(5457),k=o(9085);const T={foldgutter:!0,ref:"editor"};function S(e,t,o,s,r,i){return(0,n.wg)(),(0,n.iD)("textarea",T,null,512)}var I=o(6195),q=o(3555),P=o.n(q);o(3826),o(8690),o(4323),o(433),o(258),o(1060),o(2522),o(3206),o(18),o(617),o(668),o(9622),o(9763),o(5615),o(791),o(3563),o(3016),o(407),o(6684),o(280),o(1175),o(4842),o(7206),o(1998),o(4389),o(6253);const A=(0,n.aZ)({name:"code-editor",props:{documentKey:String,value:String},computed:{theme(){return this.store.editorTheme},mode(){return this.store.editorMode}},watch:{windowHeight:function(){this.cm.setSize(null,document.querySelector(".CodeMirror").parentElement.clientHeight)},theme:function(){this.cm.setOption("theme",this.store.editorTheme.toLowerCase())},mode:function(){this.cm.setOption("mode",this.cmMode(this.store.editorMode))}},methods:{execCommand(e){this.cm.execCommand(e),this.cm.focus()},cmMode(e){switch(e){case"C++":return"text/x-c++src";case"C#":return"text/x-csharp";case"JavaScript":return"text/javascript";case"Rust":return"text/x-rustsrc";case"Go":case"Java":case"PHP":case"Python":case"Ruby":case"Swift":return"text/x-"+e.toLowerCase();default:return"text/javascript"}},updateValue(e){const t=this.cm.getScrollInfo(),o=this.cm.getCursor(),n=this.cm.listSelections();this.cm.replaceRange(e,{line:0,ch:0},{line:this.cm.lastLine()},"automerge"),setTimeout((()=>{this.cm.setCursor(o),this.cm.scrollTo(t.left,t.top),this.cm.setSelections(n,null,{scroll:!1})}),0)},setAnchor(e){let t,o;this.removeAnchor(e.peerId),this.anchorMap[e.peerId]=[],e.stIndex!==e.edIndex&&(t=this.cm.posFromIndex(e.stIndex),o=this.cm.posFromIndex(e.edIndex),this.anchorMap[e.peerId].push(this.cm.markText(t,o,{className:"selection selection-"+e.peerId}))),e.stIndex===e.edIndex&&(e.stIndex=Math.max(0,e.stIndex-1));const n=e.prefixed?e.stIndex:e.edIndex;t=this.cm.posFromIndex(n+(e.prefixed?0:-1)),o=this.cm.posFromIndex(n+(e.prefixed?1:0)),this.anchorMap[e.peerId].push(this.cm.markText(t,o,{className:" cursor "+(e.prefixed?"left-"+e.peerId:"right-"+e.peerId)}))},removeAnchor(e){e in this.anchorMap&&(this.anchorMap[e].forEach((e=>e.clear())),delete this.anchorMap[e])}},setup(){const e=(0,k.o)(),{height:t}=(0,I.i)();return{windowHeight:t,anchorMap:{},store:e}},mounted(){this.cm=P().fromTextArea(this.$refs.editor,{theme:this.store.editorTheme.toLowerCase()||"neat",mode:this.cmMode(this.store.editorMode),lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseBrackets:!0,tabSize:2,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,extraKeys:{"Cmd-/":"toggleComment","Ctrl-/":"toggleComment"}}),this.cm.setValue(this.value),this.cm.doc.clearHistory(),this.cm.refresh(),this.cm.on("inputRead",(function(e){if(e.state.completionActive)return;let t=e.getCursor(),o=e.getTokenAt(t);o.type&&"comment"!=o.type&&P().commands.autocomplete(e,null,{completeSingle:!1})})),this.cm.on("change",((e,t)=>{this.emitter.emit("handleChanges",{key:this.documentKey,origin:t.origin,stIndex:e.indexFromPos(t.from),delta:t.removed.join("\n").length,text:t.text.join("\n")})})),this.cm.on("cursorActivity",(e=>{const t=e.indexFromPos(e.getCursor("start")),o=e.indexFromPos(e.getCursor("end")),n=e.indexFromPos(e.getCursor("head")),s=n===t&&t!==o;this.emitter.emit("handleCursorActivity",{key:this.documentKey,stIndex:t,edIndex:o,prefixed:s})})),this.emitter.on("execCommand"+this.documentKey,(e=>{this.execCommand(e)})),this.emitter.on("refresh"+this.documentKey,(()=>{setTimeout((()=>{this.cm.refresh()}),1)})),this.emitter.on("updateValue"+this.documentKey,(e=>{this.updateValue(e)})),this.emitter.on("setAnchor"+this.documentKey,(e=>{this.setAnchor(e)})),this.emitter.on("removeAnchor",(e=>{this.removeAnchor(e)})),this.cm.setSize(null,document.querySelector(".CodeMirror").parentElement.clientHeight),window.onbeforeunload=function(){return!1}}});var $=o(1639);const _=(0,$.Z)(A,[["render",S]]),M=_,j={class:"text-h6"};function O(e,t,o,r,i,a){const c=(0,n.up)("q-card-section"),l=(0,n.up)("q-btn"),d=(0,n.up)("q-card-actions"),h=(0,n.up)("q-card"),u=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.j4)(u,{ref:"dialogRef",onHide:r.onDialogHide},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{class:"q-dialog-plugin"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n._)("div",j,(0,s.zw)(o.title),1)])),_:1}),(0,n.Wm)(c,{class:"q-pt-none",style:{"overflow-wrap":"break-word"}},{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(o.message),1)])),_:1}),(0,n.Wm)(d,{align:"right"},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{flat:"",label:e.$t("ok"),color:"accent",onClick:r.onDialogOK},null,8,["label","onClick"]),o.cancelBtn?((0,n.wg)(),(0,n.j4)(l,{key:0,flat:"",label:e.$t("cancel"),color:"accent",onClick:r.onDialogCancel},null,8,["label","onClick"])):(0,n.kq)("",!0)])),_:1})])),_:1})])),_:1},8,["onHide"])}var H=o(4182);const L={props:{title:{required:!1,type:String},message:{required:!1,type:String},cancelBtn:{required:!1,default:!0,type:Boolean}},emits:[...H.Z.emits],setup(){const{dialogRef:e,onDialogHide:t,onDialogOK:o,onDialogCancel:n}=(0,H.Z)();return{dialogRef:e,onDialogHide:t,onDialogOK:o,onDialogCancel:n}}};var E=o(3706),D=o(4458),Z=o(3190),V=o(1821),B=o(963),F=o(9984),K=o.n(F);const U=(0,$.Z)(L,[["render",O]]),N=U;K()(L,"components",{QDialog:E.Z,QCard:D.Z,QCardSection:Z.Z,QCardActions:V.Z,QBtn:B.Z});var Q=o(6503);const W=(0,n.aZ)({name:"IndexPage",components:{CodeEditor:M},computed:{theme(){return this.store.editorTheme}},watch:{theme:function(){this.updateTabStyles()}},setup(){const e=(0,x.Z)(),t=(0,k.o)(),o=null!==localStorage.getItem("dark")?JSON.parse(localStorage.getItem("dark")):e.dark.isActive;e.dark.set(o);const n=localStorage.getItem("theme");return n&&t.setEditorTheme(n),{automerge:Q.init(),documents:(0,w.iH)({}),currentTab:(0,w.iH)(""),activeTabStyles:(0,w.iH)({background:"",color:"",shadow:""}),peerId:(0,w.iH)(""),connectUrl:(0,w.iH)(""),connectedPeers:(0,w.iH)({}),store:t}},mounted(){const e=(0,n.Fl)((()=>this.$t("appTitle")));(0,C.Z)((()=>({title:e.value}))),this.connectUrl=window.location.origin+window.location.pathname+"?connect=",this.emitter.on("newTab",(e=>{e?this.newTab(e.name,e.value):this.newTab()})),this.emitter.on("handleChanges",(e=>{this.handleChanges(e)})),this.emitter.on("handleCursorActivity",(e=>{this.handleCursorActivity(e)})),this.emitter.on("execCommand",(e=>{this.emitter.emit("execCommand"+this.currentTab,e)})),this.emitter.on("saveFile",(()=>{this.saveFile()})),this.updateTabStyles(),this.peer.on("open",(e=>{this.peerId=e,this.$route.query.hasOwnProperty("connect")&&this.connect()})),this.peer.on("connection",(e=>{e.on("open",(()=>{this.addStyleTag(e.peer);let t=[];const o=Q.getChanges(Q.init(),this.automerge);for(const e of o)t.push(e.toString());e.send({type:"input",changes:t}),this.connectedPeers[e.peer]=e,e.on("data",(o=>{switch(o.type){case"input":t=[];for(const e of o.changes)t.push(Uint8Array.from(e.replace("[","").replace("]","").split(",")));let n;[this.automerge,n]=Q.applyChanges(this.automerge,t);let s={};Object.keys(this.automerge).forEach((e=>{s[e]={name:this.automerge[e].name}})),this.documents=s,Object.keys(this.automerge).forEach((e=>{this.emitter.emit("updateValue"+e,this.automerge[e].value.toString())})),this.documents.hasOwnProperty(this.currentTab)||(this.currentTab=Object.keys(this.documents)[0]),this.broadcast(o,e.peer);break;case"cursor":this.emitter.emit("setAnchor"+o.changes.key,{peerId:e.peer,...o.changes});break}}))})),e.on("close",(()=>{this.onConnectionClose(e.peer)}))})),this.peer.on("disconnected",(()=>{this.peer.reconnect(),setTimeout((()=>{this.peer.disconnected&&this.$q.dialog({component:N,componentProps:{title:this.$t("errorTitle"),message:this.$t("index.peer.disconnectedMessage"),cancelBtn:!1}})}),5e3)})),this.peer.on("error",(e=>{"peer-unavailable"!=e.type&&"server-error"!=e.type||(this.$q.loading.hide(),this.$q.dialog({component:N,componentProps:{title:this.$t("errorTitle"),message:this.$t("index.peer.errorMessage"),cancelBtn:!1}}))}))},methods:{updateTabStyles(){return new Promise(((e,t)=>{const o=setInterval((function(){document.querySelector(".CodeMirror")&&(clearInterval(o),e())}),250)})).then((()=>{let e=document.querySelector(".CodeMirror");this.activeTabStyles.background=window.getComputedStyle(e).getPropertyValue("background"),this.activeTabStyles.color=window.getComputedStyle(e).getPropertyValue("color"),this.activeTabStyles.shadow="0 10px 0 "+window.getComputedStyle(e).getPropertyValue("background").match(/rgb\(.*\)/gi)[0]}))},addStyleTag(e){let t=0;for(let r of e)t+=r.charCodeAt(0);let o=t.toString(16);while(o.length<3)o+=o[o.length-1];o=o.substr(0,3);let n="#";for(let r of o)n+=`${r}0`;let s=document.createElement("style");s.type="text/css",s.setAttribute("id",e),s.appendChild(document.createTextNode(`\n        .selection-${e} {\n          background-color: ${n};\n        }\n        .left-${e} {\n          box-shadow: -1px 0 0 0 ${n};\n          animation: cursor-left 1s step-end infinite;\n        }\n        .right-${e} {\n          box-shadow: 1px 0 0 0 ${n};\n          animation: cursor-right 1s step-end infinite;\n        }\n      `)),document.getElementsByTagName("head")[0].appendChild(s)},copyLink(){const e=window.clipboardData||navigator.clipboard;e.writeText(this.connectUrl+this.peerId)},newTab(e="Undefined",t=""){let o=(Math.random()+1).toString(36).substring(2);this.automerge=Q.change(this.automerge,"newTab",(n=>{n[o]={name:e,value:new Q.Text(t)}})),this.documents[o]={name:e};let n=Q.getLastLocalChange(this.automerge);this.broadcast({type:"input",changes:[n.toString()]}),this.currentTab=o},closeTab(e,t){let o=this.currentTab,n=Object.keys(this.documents);this.automerge=Q.change(this.automerge,"closeTab",(t=>{delete t[e]})),delete this.documents[e];let s=Q.getLastLocalChange(this.automerge);this.broadcast({type:"input",changes:[s.toString()]}),this.currentTab==e&&(o=n[t-1]||n[t+1]||""),this.currentTab="",this.currentTab=o},tabClickHandler(e,t,o,n){if(e.target==this.$refs["close_"+t][0]){if(!this.automerge[t].value.length)return void this.closeTab(t,o);this.currentTab=t,this.$q.dialog({component:N,componentProps:{title:this.$t("index.fileCloseTitle")+n,message:this.$t("index.changesLostMessage")}}).onOk((()=>{this.closeTab(t,o)}))}else this.currentTab=t;this.emitter.emit("refresh"+t)},updateDocName(e){this.automerge=Q.change(this.automerge,"changes",(t=>{t[e].name=this.documents[e].name}));let t=Q.getLastLocalChange(this.automerge);this.broadcast({type:"input",changes:[t.toString()]})},handleChanges(e){if("automerge"==e.origin)return;this.automerge=Q.change(this.automerge,"changes",(t=>{t[e.key].value.deleteAt(e.stIndex,e.delta),t[e.key].value.insertAt(e.stIndex,...e.text.split(""))}));let t=Q.getLastLocalChange(this.automerge);this.broadcast({type:"input",changes:[t.toString()]});let o={};Object.keys(this.automerge).forEach((e=>{o[e]={name:this.automerge[e].name}})),this.documents=o},handleCursorActivity(e){this.broadcast({type:"cursor",changes:e})},saveFile(){if(!this.automerge[this.currentTab].value.length)return;let e=document.createElement("a");if(e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(this.automerge[this.currentTab].value)),e.setAttribute("download",this.automerge[this.currentTab].name),document.createEvent){let t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}else e.click()},connect(){let e=this.peer.connect(this.$route.query.connect);this.store.toggleSidePanel(),this.$q.loading.show({message:this.$t("index.peer.connectingMessage")}),e.on("open",(()=>{this.$q.loading.hide(),this.connectedPeers[e.peer]=e,this.addStyleTag(e.peer),e.on("data",(t=>{switch(t.type){case"input":let o,n=[];for(const e of t.changes)n.push(Uint8Array.from(e.replace("[","").replace("]","").split(",")));[this.automerge,o]=Q.applyChanges(this.automerge,n);let s={};Object.keys(this.automerge).forEach((e=>{s[e]={name:this.automerge[e].name}})),this.documents=s,Object.keys(this.automerge).forEach((e=>{this.emitter.emit("updateValue"+e,this.automerge[e].value.toString())})),this.documents.hasOwnProperty(this.currentTab)||(this.currentTab=Object.keys(this.documents)[0]),this.broadcast(t,e.peer);break;case"cursor":this.emitter.emit("setAnchor"+t.changes.key,{peerId:e.peer,...t.changes});break}}))})),e.on("close",(()=>{this.onConnectionClose(e.peer)}))},onConnectionClose(e){delete this.connectedPeers[e],this.emitter.emit("removeAnchor",e);let t=document.getElementById(e);t.parentNode.removeChild(t)},broadcast(e,t=""){Object.keys(this.connectedPeers).forEach((o=>{o!=t&&this.connectedPeers[o].send(e)}))}}});var R=o(9885),z=o(2857);const J=(0,$.Z)(W,[["render",v]]),G=J;K()(W,"components",{QPage:R.Z,QBtn:B.Z,QIcon:z.Z})}}]);